<html> 
  <head>
    <link rel='stylesheet' type='text/css' href='styles.css'>
    <title>Main - Agrexa</title>
    <style>
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
    <script src="connect.js"></script>
    <script>
      function on_load(){
        link = document.getElementById('account');
        total = 0;
        minus = 0;
        plus = 0;
        firebase.auth().onAuthStateChanged(user => {
          if (user) {
              link.href = 'account.html';
              data = firebase.database().ref('users/'+user.uid+'/owes').once('value', (snapshot) => {
                snapshot.forEach((childSnapshot) => {
                  li = document.createElement("li");
                  a = document.createElement("a");
                  a.appendChild(document.createTextNode(childSnapshot.val().event));
                  a.href = "item.html?id=" + childSnapshot.key;
                  li.appendChild(a);
                  if (childSnapshot.val().sign == '+'){
                    list = document.getElementById("plus_list");
                    list.appendChild(li);
                    plus += childSnapshot.val().difference;
                  }
                  else{
                    list = document.getElementById("minus_list");
                    list.appendChild(li);
                    minus += childSnapshot.val().difference;
                  }
                });
                document.getElementById("minus_label").innerHTML = "You owe: " + minus + '$';
                document.getElementById("plus_label").innerHTML = "You are owed: " + plus + '$';
                document.getElementById("total_label").innerHTML = "Total balance: " + (plus - minus) + '$';
              });
            } else {
              const googleAuth = new firebase.auth.GoogleAuthProvider();
              firebase.auth().signInWithPopup(googleAuth);
          }
        });
      }
      window.onload = on_load;
    </script>
  </head>
  <body>
    <header>
      <div class="topbar">
        <div>
          <label class="switch">
            <input type="checkbox" id="togBtn">
            <div class="slider round"></div>
          </label>
        </div><!-- 
        --><div>
              <a href="index.html" class="topbar__site-name">Agrexa</a>
            </div><!-- 
          --><div>
              <a href="signup.html" class="topbar__account" id='account'>Account</a>
        </div>
      </div>
    </header>
    <main>
      <div class="dashboard">
        <div>
        </div><!-- 
        --><div>
          <label>Dashboard</label>
        </div><!-- 
        --><div>
          <form>
            <button formaction="createowe.html">Create owe</button>
          </form>
        </div>
      </div>
      <div class="oweboard">
        <div>
          <label id="plus_label">
        </div><!-- 
        --><div>
          <label id="total_label">
        </div><!-- 
        --><div>
          <label id="minus_label">
        </div>
      </div>
      <div class="oweboard__container">
        <label>You are owed: </label>
        <label>You owe: </label>
      </div>
      <div class="oweboard__container">
        <div class="oweboard__container-item">
          <ol id="plus_list">
            <li><a href="item.html">temp 1.1</a>
          </ol>
        </div>
        <div class="oweboard__container-item">
          <ol id="minus_list">
          </ol>
        </div>
      </div>
    </main>
    <footer>
      <h3>Khatskevich, 2021
    </footer>
  </body>
</html>